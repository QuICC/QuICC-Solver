(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    118524,       2890]
NotebookOptionsPosition[    115539,       2846]
NotebookOutlinePosition[    115934,       2862]
CellTagsIndexPosition[    115891,       2859]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"nbPath", "=", 
   RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"nbDepth", "=", 
   RowBox[{"FileNameDepth", "[", "nbPath", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"quiccroot", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{
     RowBox[{"FileNameSplit", "[", "nbPath", "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"1", ";;", 
       RowBox[{"nbDepth", "-", "4"}]}], "]"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dataroot", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"Flatten", "[", 
     RowBox[{"{", 
      RowBox[{
      "quiccroot", ",", "\"\<build\>\"", ",", "\"\<Components\>\"", ",", 
       "\"\<Transform\>\"", ",", "\"\<TestSuite\>\""}], "}"}], "]"}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"!", 
      RowBox[{"DirectoryQ", "[", "dataroot", "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"dataroot", "::", "wrongpath"}], ",", "dataroot"}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"datadir", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<_data\>\"", ",", "\"\<Transform\>\"", ",", "\"\<Chebyshev\>\"", ",", 
     "\"\<LinearMap\>\""}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"refdir", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<_refdata\>\"", ",", "\"\<Transform\>\"", ",", "\"\<Chebyshev\>\"", 
     ",", "\"\<LinearMap\>\""}], "}"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9406435656458673`*^9, 3.940643601904934*^9}, {
  3.9406436942299557`*^9, 3.940643707779244*^9}},
 CellLabel->"In[22]:=",ExpressionUUID->"d658a15c-d0fa-4364-885d-b052f24ca2ad"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"$MaxExtraPrecision", "=", "1000"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mpprec", "=", "100"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"chebgrid", "[", "n_", "]"}], ":=", 
  RowBox[{"N", "[", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Cos", "[", 
       RowBox[{
        FractionBox[
         RowBox[{
          RowBox[{"2", "k"}], "-", "1"}], 
         RowBox[{"2", "n"}]], "\[Pi]"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"k", ",", "1", ",", "n"}], "}"}]}], "]"}], ",", "mpprec"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"chebweights", "[", "n_", "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     FractionBox["1", "n"], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", "n"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dChebyshev", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "t_"}], "]"}], "=", 
   RowBox[{"Simplify", "[", 
    RowBox[{
     FractionBox["1", "a"], 
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"ChebyshevT", "[", 
        RowBox[{"n", ",", "t"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"t", ",", "1"}], "}"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dyChebyshev", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "t_"}], "]"}], "=", 
   RowBox[{"Simplify", "[", 
    RowBox[{
     RowBox[{"ChebyshevT", "[", 
      RowBox[{"n", ",", "t"}], "]"}], "+", 
     RowBox[{
      FractionBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"a", " ", "t"}], " ", "+", " ", "b"}], ")"}], "a"], 
      RowBox[{"D", "[", 
       RowBox[{
        RowBox[{"ChebyshevT", "[", 
         RowBox[{"n", ",", "t"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", "1"}], "}"}]}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"d2Chebyshev", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "t_"}], "]"}], "=", 
   RowBox[{"Simplify", "[", 
    RowBox[{
     FractionBox["1", 
      SuperscriptBox["a", "2"]], 
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"ChebyshevT", "[", 
        RowBox[{"n", ",", "t"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"t", ",", "2"}], "}"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"d3Chebyshev", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "t_"}], "]"}], "=", 
   RowBox[{"Simplify", "[", 
    RowBox[{
     FractionBox["1", 
      SuperscriptBox["a", "3"]], 
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"ChebyshevT", "[", 
        RowBox[{"n", ",", "t"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"t", ",", "3"}], "}"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"d4Chebyshev", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "t_"}], "]"}], "=", 
   RowBox[{"Simplify", "[", 
    RowBox[{
     FractionBox["1", 
      SuperscriptBox["a", "4"]], 
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"ChebyshevT", "[", 
        RowBox[{"n", ",", "t"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"t", ",", "4"}], "}"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"slaplChebyshev", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "t_"}], "]"}], "=", 
   RowBox[{"Simplify", "[", 
    RowBox[{
     RowBox[{"d2Chebyshev", "[", 
      RowBox[{"n", ",", "a", ",", "b", ",", "t"}], "]"}], " ", "+", " ", 
     RowBox[{
      FractionBox["2", 
       RowBox[{
        RowBox[{"a", " ", "t"}], " ", "+", "b"}]], 
      RowBox[{"dChebyshev", "[", 
       RowBox[{"n", ",", "a", ",", "b", ",", "t"}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Tnabl", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "l_", ",", "x_"}], "]"}], ":=", 
   RowBox[{"ChebyshevT", "[", 
    RowBox[{"n", ",", "x"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dTnabl", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "l_", ",", "x_"}], "]"}], ":=", 
   RowBox[{"dChebyshev", "[", 
    RowBox[{"n", ",", "a", ",", "b", ",", "x"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"d2Tnabl", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "l_", ",", "x_"}], "]"}], ":=", 
   RowBox[{"d2Chebyshev", "[", 
    RowBox[{"n", ",", "a", ",", "b", ",", "x"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"d3Tnabl", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "l_", ",", "x_"}], "]"}], ":=", 
   RowBox[{"d3Chebyshev", "[", 
    RowBox[{"n", ",", "a", ",", "b", ",", "x"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"d4Tnabl", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "l_", ",", "x_"}], "]"}], ":=", 
   RowBox[{"d4Chebyshev", "[", 
    RowBox[{"n", ",", "a", ",", "b", ",", "x"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dyTnabl", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "l_", ",", "x_"}], "]"}], ":=", 
   RowBox[{"dyChebyshev", "[", 
    RowBox[{"n", ",", "a", ",", "b", ",", "x"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"yTnabl", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "l_", ",", "x_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"a", " ", "x"}], " ", "+", " ", "b"}], ")"}], 
    RowBox[{"ChebyshevT", "[", 
     RowBox[{"n", ",", "x"}], "]"}]}]}], ";", 
  RowBox[{
   RowBox[{"y2Tnabl", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "l_", ",", "x_"}], "]"}], ":=", 
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       RowBox[{"a", " ", "x"}], " ", "+", " ", "b"}], ")"}], "2"], 
    RowBox[{"ChebyshevT", "[", 
     RowBox[{"n", ",", "x"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"y3Tnabl", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "l_", ",", "x_"}], "]"}], ":=", 
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       RowBox[{"a", " ", "x"}], " ", "+", " ", "b"}], ")"}], "3"], 
    RowBox[{"ChebyshevT", "[", 
     RowBox[{"n", ",", "x"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ydyTnabl", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "l_", ",", "x_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"a", " ", "x"}], " ", "+", " ", "b"}], ")"}], 
    RowBox[{"dyChebyshev", "[", 
     RowBox[{"n", ",", "a", ",", "b", ",", "x"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"y2dyTnabl", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "l_", ",", "x_"}], "]"}], ":=", 
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       RowBox[{"a", " ", "x"}], " ", "+", " ", "b"}], ")"}], "2"], 
    RowBox[{"dyChebyshev", "[", 
     RowBox[{"n", ",", "a", ",", "b", ",", "x"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"y3dyTnabl", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "l_", ",", "x_"}], "]"}], ":=", 
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       RowBox[{"a", " ", "x"}], " ", "+", " ", "b"}], ")"}], "3"], 
    RowBox[{"dyChebyshev", "[", 
     RowBox[{"n", ",", "a", ",", "b", ",", "x"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"divyTnabl", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "l_", ",", "x_"}], "]"}], ":=", 
   RowBox[{
    FractionBox["1", 
     RowBox[{
      RowBox[{"a", " ", "x"}], " ", "+", " ", "b"}]], 
    RowBox[{"ChebyshevT", "[", 
     RowBox[{"n", ",", "x"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"divydyTnabl", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "l_", ",", "x_"}], "]"}], ":=", 
   RowBox[{
    FractionBox["1", 
     RowBox[{
      RowBox[{"a", " ", "x"}], " ", "+", " ", "b"}]], 
    RowBox[{"dyChebyshev", "[", 
     RowBox[{"n", ",", "a", ",", "b", ",", "x"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"divy2Tnabl", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "l_", ",", "x_"}], "]"}], ":=", 
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      FractionBox["1", 
       RowBox[{
        RowBox[{"a", " ", "x"}], " ", "+", " ", "b"}]], ")"}], "2"], 
    RowBox[{"ChebyshevT", "[", 
     RowBox[{"n", ",", "x"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"slaplTnabl", "[", 
    RowBox[{"n_", ",", "a_", ",", "b_", ",", "l_", ",", "x_"}], "]"}], ":=", 
   RowBox[{"slaplChebyshev", "[", 
    RowBox[{"n", ",", "a", ",", "b", ",", "x"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i0", "[", 
    RowBox[{"spec_", ",", "a_", ",", "b_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", " ", "\[IndentingNewLine]", "spec"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i2", "[", 
    RowBox[{"spec_", ",", "a_", ",", "b_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "grid", ",", "wgts", ",", "i2spec", ",", "gN", ",", "nN", ",", "i2g"}], 
      "}"}], ",", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nN", "=", 
       RowBox[{"Length", "[", "spec", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gN", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"2", "nN"}], ",", "10"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"chebgrid", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wgts", "=", 
       RowBox[{"chebweights", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"i2spec", "=", 
       RowBox[{"Total", "[", 
        RowBox[{"ParallelTable", "[", " ", 
         RowBox[{
          RowBox[{
           SuperscriptBox["a", "2"], 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"i", "-", "1"}], "==", "0"}], ",", "1", ",", "2"}], 
            "]"}], 
           RowBox[{"Integrate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Tnabl", "[", 
               RowBox[{
                RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
                " ", "x"}], "]"}], " ", 
              RowBox[{"spec", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "x", ",", "x"}], 
            "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"i2g", "=", 
       RowBox[{"i2spec", "/.", 
        RowBox[{"{", 
         RowBox[{"x", "->", "grid"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"i2spec", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"i2spec", "[", 
        RowBox[{"[", 
         RowBox[{"3", ";;"}], "]"}], "]"}], "=", 
       RowBox[{"ParallelTable", "[", 
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{
           RowBox[{"wgts", " ", 
            RowBox[{"Tnabl", "[", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
              "grid"}], "]"}]}], ",", " ", "i2g"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "3", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "i2spec"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i2y1", "[", 
    RowBox[{"spec_", ",", "a_", ",", "b_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "grid", ",", "wgts", ",", "i2spec", ",", "gN", ",", "nN", ",", "i2g"}], 
      "}"}], ",", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nN", "=", 
       RowBox[{"Length", "[", "spec", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gN", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"2", "nN"}], ",", "10"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"chebgrid", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wgts", "=", 
       RowBox[{"chebweights", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"i2spec", "=", 
       RowBox[{"Total", "[", 
        RowBox[{"ParallelTable", "[", " ", 
         RowBox[{
          RowBox[{
           SuperscriptBox["a", "2"], 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"i", "-", "1"}], "==", "0"}], ",", "1", ",", "2"}], 
            "]"}], 
           RowBox[{"Integrate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"yTnabl", "[", 
               RowBox[{
                RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
                " ", "x"}], "]"}], " ", 
              RowBox[{"spec", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "x", ",", "x"}], 
            "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"i2g", "=", 
       RowBox[{"i2spec", "/.", 
        RowBox[{"{", 
         RowBox[{"x", "->", "grid"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"i2spec", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"i2spec", "[", 
        RowBox[{"[", 
         RowBox[{"3", ";;"}], "]"}], "]"}], "=", 
       RowBox[{"ParallelTable", "[", 
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{
           RowBox[{"wgts", " ", 
            RowBox[{"Tnabl", "[", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
              "grid"}], "]"}]}], ",", " ", "i2g"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "3", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "i2spec"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i2y2", "[", 
    RowBox[{"spec_", ",", "a_", ",", "b_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "grid", ",", "wgts", ",", "i2spec", ",", "gN", ",", "nN", ",", "i2g"}], 
      "}"}], ",", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nN", "=", 
       RowBox[{"Length", "[", "spec", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gN", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"2", "nN"}], ",", "10"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"chebgrid", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wgts", "=", 
       RowBox[{"chebweights", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"i2spec", "=", 
       RowBox[{"Total", "[", 
        RowBox[{"ParallelTable", "[", " ", 
         RowBox[{
          RowBox[{
           SuperscriptBox["a", "2"], 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"i", "-", "1"}], "==", "0"}], ",", "1", ",", "2"}], 
            "]"}], 
           RowBox[{"Integrate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"y2Tnabl", "[", 
               RowBox[{
                RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
                " ", "x"}], "]"}], " ", 
              RowBox[{"spec", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "x", ",", "x"}], 
            "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"i2g", "=", 
       RowBox[{"i2spec", "/.", 
        RowBox[{"{", 
         RowBox[{"x", "->", "grid"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"i2spec", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"i2spec", "[", 
        RowBox[{"[", 
         RowBox[{"3", ";;"}], "]"}], "]"}], "=", 
       RowBox[{"ParallelTable", "[", 
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{
           RowBox[{"wgts", " ", 
            RowBox[{"Tnabl", "[", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
              "grid"}], "]"}]}], ",", " ", "i2g"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "3", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "i2spec"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i2d1", "[", 
    RowBox[{"spec_", ",", "a_", ",", "b_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "grid", ",", "wgts", ",", "i2spec", ",", "gN", ",", "nN", ",", "i2g"}], 
      "}"}], ",", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nN", "=", 
       RowBox[{"Length", "[", "spec", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gN", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"2", "nN"}], ",", "10"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"chebgrid", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wgts", "=", 
       RowBox[{"chebweights", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"i2spec", "=", 
       RowBox[{"Total", "[", 
        RowBox[{"ParallelTable", "[", " ", 
         RowBox[{
          RowBox[{
           SuperscriptBox["a", "2"], 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"i", "-", "1"}], "==", "0"}], ",", "1", ",", "2"}], 
            "]"}], 
           RowBox[{"Integrate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"dTnabl", "[", 
               RowBox[{
                RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
                " ", "x"}], "]"}], " ", 
              RowBox[{"spec", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "x", ",", "x"}], 
            "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"i2g", "=", 
       RowBox[{"i2spec", "/.", 
        RowBox[{"{", 
         RowBox[{"x", "->", "grid"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"i2spec", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"i2spec", "[", 
        RowBox[{"[", 
         RowBox[{"3", ";;"}], "]"}], "]"}], "=", 
       RowBox[{"ParallelTable", "[", 
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{
           RowBox[{"wgts", " ", 
            RowBox[{"Tnabl", "[", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
              "grid"}], "]"}]}], ",", " ", "i2g"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "3", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "i2spec"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i2y1d1y1", "[", 
    RowBox[{"spec_", ",", "a_", ",", "b_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "grid", ",", "wgts", ",", "i2spec", ",", "gN", ",", "nN", ",", "i2g"}], 
      "}"}], ",", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nN", "=", 
       RowBox[{"Length", "[", "spec", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gN", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"2", "nN"}], ",", "10"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"chebgrid", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wgts", "=", 
       RowBox[{"chebweights", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"i2spec", "=", 
       RowBox[{"Total", "[", 
        RowBox[{"ParallelTable", "[", " ", 
         RowBox[{
          RowBox[{
           SuperscriptBox["a", "2"], 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"i", "-", "1"}], "==", "0"}], ",", "1", ",", "2"}], 
            "]"}], 
           RowBox[{"Integrate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ydyTnabl", "[", 
               RowBox[{
                RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
                " ", "x"}], "]"}], " ", 
              RowBox[{"spec", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "x", ",", "x"}], 
            "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"i2g", "=", 
       RowBox[{"i2spec", "/.", 
        RowBox[{"{", 
         RowBox[{"x", "->", "grid"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"i2spec", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"i2spec", "[", 
        RowBox[{"[", 
         RowBox[{"3", ";;"}], "]"}], "]"}], "=", 
       RowBox[{"ParallelTable", "[", 
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{
           RowBox[{"wgts", " ", 
            RowBox[{"Tnabl", "[", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
              "grid"}], "]"}]}], ",", " ", "i2g"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "3", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "i2spec"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i2y2d1y1", "[", 
    RowBox[{"spec_", ",", "a_", ",", "b_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "grid", ",", "wgts", ",", "i2spec", ",", "gN", ",", "nN", ",", "i2g"}], 
      "}"}], ",", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nN", "=", 
       RowBox[{"Length", "[", "spec", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gN", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"2", "nN"}], ",", "10"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"chebgrid", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wgts", "=", 
       RowBox[{"chebweights", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"i2spec", "=", 
       RowBox[{"Total", "[", 
        RowBox[{"ParallelTable", "[", " ", 
         RowBox[{
          RowBox[{
           SuperscriptBox["a", "2"], 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"i", "-", "1"}], "==", "0"}], ",", "1", ",", "2"}], 
            "]"}], 
           RowBox[{"Integrate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"y2dyTnabl", "[", 
               RowBox[{
                RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
                " ", "x"}], "]"}], " ", 
              RowBox[{"spec", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "x", ",", "x"}], 
            "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"i2g", "=", 
       RowBox[{"i2spec", "/.", 
        RowBox[{"{", 
         RowBox[{"x", "->", "grid"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"i2spec", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"i2spec", "[", 
        RowBox[{"[", 
         RowBox[{"3", ";;"}], "]"}], "]"}], "=", 
       RowBox[{"ParallelTable", "[", 
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{
           RowBox[{"wgts", " ", 
            RowBox[{"Tnabl", "[", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
              "grid"}], "]"}]}], ",", " ", "i2g"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "3", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "i2spec"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i2Zi2d1", "[", 
    RowBox[{"spec_", ",", "a_", ",", "b_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "i2spec", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"i2spec", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"l", "==", "0"}], ",", 
         RowBox[{"i2d1", "[", 
          RowBox[{"spec", ",", "a", ",", "b", ",", "l"}], "]"}], ",", 
         RowBox[{"i2", "[", 
          RowBox[{"spec", ",", "a", ",", "b", ",", "l"}], "]"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", "i2spec"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i2d1Zi2", "[", 
    RowBox[{"spec_", ",", "a_", ",", "b_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "i2spec", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"i2spec", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"l", "==", "0"}], ",", 
         RowBox[{"i2", "[", 
          RowBox[{"spec", ",", "a", ",", "b", ",", "l"}], "]"}], ",", 
         RowBox[{"i2d1", "[", 
          RowBox[{"spec", ",", "a", ",", "b", ",", "l"}], "]"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", "i2spec"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i4", "[", 
    RowBox[{"spec_", ",", "a_", ",", "b_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "grid", ",", "wgts", ",", "i4spec", ",", "gN", ",", "nN", ",", "i4g"}], 
      "}"}], ",", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nN", "=", 
       RowBox[{"Length", "[", "spec", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gN", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"2", "nN"}], ",", "10"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"chebgrid", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wgts", "=", 
       RowBox[{"chebweights", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"i4spec", "=", 
       RowBox[{"Total", "[", 
        RowBox[{"ParallelTable", "[", "  ", 
         RowBox[{
          RowBox[{
           SuperscriptBox["a", "4"], 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"i", "-", "1"}], "==", "0"}], ",", "1", ",", "2"}], 
            "]"}], 
           RowBox[{"Integrate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Tnabl", "[", 
               RowBox[{
                RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
                " ", "x"}], "]"}], " ", 
              RowBox[{"spec", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "x", ",", "x", ",", "x",
              ",", "x"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"i4g", "=", 
       RowBox[{"i4spec", "/.", 
        RowBox[{"{", 
         RowBox[{"x", "->", "grid"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"i4spec", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"i4spec", "[", 
        RowBox[{"[", 
         RowBox[{"5", ";;"}], "]"}], "]"}], "=", 
       RowBox[{"ParallelTable", "[", 
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{
           RowBox[{"wgts", " ", 
            RowBox[{"Tnabl", "[", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
              "grid"}], "]"}]}], ",", " ", "i4g"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "5", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "i4spec"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i4y3", "[", 
    RowBox[{"spec_", ",", "a_", ",", "b_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "grid", ",", "wgts", ",", "i4spec", ",", "gN", ",", "nN", ",", "i4g"}], 
      "}"}], ",", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nN", "=", 
       RowBox[{"Length", "[", "spec", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gN", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"2", "nN"}], ",", "10"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"chebgrid", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wgts", "=", 
       RowBox[{"chebweights", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"i4spec", "=", 
       RowBox[{"Total", "[", 
        RowBox[{"ParallelTable", "[", "  ", 
         RowBox[{
          RowBox[{
           SuperscriptBox["a", "4"], 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"i", "-", "1"}], "==", "0"}], ",", "1", ",", "2"}], 
            "]"}], 
           RowBox[{"Integrate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"y3Tnabl", "[", 
               RowBox[{
                RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
                " ", "x"}], "]"}], " ", 
              RowBox[{"spec", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "x", ",", "x", ",", "x",
              ",", "x"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"i4g", "=", 
       RowBox[{"i4spec", "/.", 
        RowBox[{"{", 
         RowBox[{"x", "->", "grid"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"i4spec", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"i4spec", "[", 
        RowBox[{"[", 
         RowBox[{"5", ";;"}], "]"}], "]"}], "=", 
       RowBox[{"ParallelTable", "[", 
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{
           RowBox[{"wgts", " ", 
            RowBox[{"Tnabl", "[", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
              "grid"}], "]"}]}], ",", " ", "i4g"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "5", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "i4spec"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i4d1", "[", 
    RowBox[{"spec_", ",", "a_", ",", "b_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "grid", ",", "wgts", ",", "i4spec", ",", "gN", ",", "nN", ",", "i4g"}], 
      "}"}], ",", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nN", "=", 
       RowBox[{"Length", "[", "spec", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gN", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"2", "nN"}], ",", "10"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"chebgrid", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wgts", "=", 
       RowBox[{"chebweights", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"i4spec", "=", 
       RowBox[{"Total", "[", 
        RowBox[{"ParallelTable", "[", "  ", 
         RowBox[{
          RowBox[{
           SuperscriptBox["a", "4"], 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"i", "-", "1"}], "==", "0"}], ",", "1", ",", "2"}], 
            "]"}], 
           RowBox[{"Integrate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"dTnabl", "[", 
               RowBox[{
                RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
                " ", "x"}], "]"}], " ", 
              RowBox[{"spec", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "x", ",", "x", ",", "x",
              ",", "x"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"i4g", "=", 
       RowBox[{"i4spec", "/.", 
        RowBox[{"{", 
         RowBox[{"x", "->", "grid"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"i4spec", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"i4spec", "[", 
        RowBox[{"[", 
         RowBox[{"5", ";;"}], "]"}], "]"}], "=", 
       RowBox[{"ParallelTable", "[", 
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{
           RowBox[{"wgts", " ", 
            RowBox[{"Tnabl", "[", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
              "grid"}], "]"}]}], ",", " ", "i4g"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "5", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "i4spec"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i4y3d1y1", "[", 
    RowBox[{"spec_", ",", "a_", ",", "b_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "grid", ",", "wgts", ",", "i4spec", ",", "gN", ",", "nN", ",", "i4g"}], 
      "}"}], ",", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nN", "=", 
       RowBox[{"Length", "[", "spec", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gN", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"2", "nN"}], ",", "10"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"chebgrid", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wgts", "=", 
       RowBox[{"chebweights", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"i4spec", "=", 
       RowBox[{"Total", "[", 
        RowBox[{"ParallelTable", "[", "  ", 
         RowBox[{
          RowBox[{
           SuperscriptBox["a", "4"], 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"i", "-", "1"}], "==", "0"}], ",", "1", ",", "2"}], 
            "]"}], 
           RowBox[{"Integrate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"y3dyTnabl", "[", 
               RowBox[{
                RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
                " ", "x"}], "]"}], " ", 
              RowBox[{"spec", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "x", ",", "x", ",", "x",
              ",", "x"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"i4g", "=", 
       RowBox[{"i4spec", "/.", 
        RowBox[{"{", 
         RowBox[{"x", "->", "grid"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"i4spec", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"i4spec", "[", 
        RowBox[{"[", 
         RowBox[{"5", ";;"}], "]"}], "]"}], "=", 
       RowBox[{"ParallelTable", "[", 
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{
           RowBox[{"wgts", " ", 
            RowBox[{"Tnabl", "[", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
              "grid"}], "]"}]}], ",", " ", "i4g"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "5", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "i4spec"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i4d1Zi2", "[", 
    RowBox[{"spec_", ",", "a_", ",", "b_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "i4spec", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"i4spec", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"l", "==", "0"}], ",", 
         RowBox[{"i2", "[", 
          RowBox[{"spec", ",", "a", ",", "b", ",", "l"}], "]"}], ",", 
         RowBox[{"i4d1", "[", 
          RowBox[{"spec", ",", "a", ",", "b", ",", "l"}], "]"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", "i4spec"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"i6", "[", 
    RowBox[{"spec_", ",", "a_", ",", "b_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "grid", ",", "wgts", ",", "i6spec", ",", "gN", ",", "nN", ",", "i6g"}], 
      "}"}], ",", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nN", "=", 
       RowBox[{"Length", "[", "spec", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gN", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"2", "nN"}], ",", "10"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"chebgrid", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wgts", "=", 
       RowBox[{"chebweights", "[", "gN", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"i6spec", "=", 
       RowBox[{"Total", "[", 
        RowBox[{"ParallelTable", "[", "  ", 
         RowBox[{
          RowBox[{
           SuperscriptBox["a", "6"], 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"i", "-", "1"}], "==", "0"}], ",", "1", ",", "2"}], 
            "]"}], 
           RowBox[{"Integrate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Tnabl", "[", 
               RowBox[{
                RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
                " ", "x"}], "]"}], " ", 
              RowBox[{"spec", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "x", ",", "x", ",", "x",
              ",", "x", ",", "x", ",", "x"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"i6g", "=", 
       RowBox[{"i6spec", "/.", 
        RowBox[{"{", 
         RowBox[{"x", "->", "grid"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"i6spec", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"i6spec", "[", 
        RowBox[{"[", 
         RowBox[{"7", ";;"}], "]"}], "]"}], "=", 
       RowBox[{"ParallelTable", "[", 
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{
           RowBox[{"wgts", " ", 
            RowBox[{"Tnabl", "[", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", "l", ",", 
              "grid"}], "]"}]}], ",", " ", "i6g"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "7", ",", "nN"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "i6spec"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"unitSpectrum", "[", 
    RowBox[{"n_", ",", "maxN_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"1", "-", 
    RowBox[{"2", "\[ImaginaryI]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"maxSpectrum", "[", 
    RowBox[{"n_", ",", "maxN_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"n", "==", "maxN"}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"2", "\[ImaginaryI]"}]}], ",", "0"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"minSpectrum", "[", 
    RowBox[{"n_", ",", "maxN_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"n", "==", "1"}], ",", "1", ",", "0"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"abSphere", "[", "riro_", "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", "b", ",", "ri", ",", "ro", ",", "sol", ",", "xixo"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"sol", "=", 
       RowBox[{
        RowBox[{"Solve", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"-", "a"}], "+", "b"}], "==", " ", "ri"}], " ", "&&", " ", 
          RowBox[{
           RowBox[{"a", "+", "b"}], "==", "ro"}], " ", "&&", " ", 
          RowBox[{
           FractionBox["ri", "ro"], " ", "==", "riro"}], " ", "&&", " ", 
          RowBox[{
           RowBox[{"ro", " ", "-", " ", "ri"}], " ", "==", " ", "1"}]}], 
         "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"xixo", " ", "=", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"ri", ",", "ro"}], "}"}], "/.", "sol"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<{xi,xo} -> \>\"", " ", "<>", " ", 
        RowBox[{"ToString", "[", 
         RowBox[{"xixo", "//", "N"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"a", ",", "b"}], "}"}], "/.", "sol"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.848629853061253*^9, 3.848629853226049*^9}, {
   3.848630842382434*^9, 3.848630882753738*^9}, {3.848631371729781*^9, 
   3.848631373201935*^9}, 3.848633799659297*^9, 3.848634011648475*^9, {
   3.848634047182176*^9, 3.848634056967564*^9}, {3.848636163867277*^9, 
   3.848636165373761*^9}, {3.848636402300872*^9, 3.8486364215133543`*^9}, {
   3.84863652833937*^9, 3.848636559276078*^9}, {3.84863663111751*^9, 
   3.8486366372419653`*^9}, 3.848636668298191*^9, {3.848636719540948*^9, 
   3.84863672708985*^9}, {3.848636782339882*^9, 3.8486368485097737`*^9}, {
   3.848637015594987*^9, 3.848637018955174*^9}, {3.848637607491601*^9, 
   3.8486376145839243`*^9}, {3.848637721939672*^9, 3.848637722134841*^9}, {
   3.848637822650089*^9, 3.848637822988048*^9}, 3.848637972031766*^9, {
   3.8486380888358393`*^9, 3.848638091651805*^9}, {3.848638308993633*^9, 
   3.848638311425069*^9}, {3.84872051739605*^9, 3.848720533796326*^9}, {
   3.848720993319086*^9, 3.848721014070304*^9}, {3.848721075151703*^9, 
   3.848721115283585*^9}, {3.8487211592650003`*^9, 3.84872122570881*^9}, {
   3.848724363579034*^9, 3.848724416219714*^9}, {3.8487244570748262`*^9, 
   3.848724536634595*^9}, {3.848724701197138*^9, 3.84872473473999*^9}, {
   3.8487248800530643`*^9, 3.848724898208542*^9}, {3.848725045487284*^9, 
   3.848725045667877*^9}, {3.8487251413803387`*^9, 3.848725157153223*^9}, {
   3.848725488300949*^9, 3.84872549025639*^9}, {3.848725668135712*^9, 
   3.848725750221643*^9}, {3.8487258035662737`*^9, 3.84872582247821*^9}, {
   3.848726016633771*^9, 3.848726030610189*^9}, {3.848726166300219*^9, 
   3.848726173328381*^9}, 3.848726513518318*^9, {3.848726793787071*^9, 
   3.848726797610491*^9}, {3.84872752863178*^9, 3.848727528829555*^9}, {
   3.848727679406424*^9, 3.848727681718019*^9}, {3.848730436423243*^9, 
   3.848730440066453*^9}, {3.8487305114001617`*^9, 3.848730520500955*^9}, {
   3.848730897356046*^9, 3.848730898236481*^9}, {3.848730972273732*^9, 
   3.848730987559434*^9}, {3.848731096203048*^9, 3.848731127387339*^9}, {
   3.84873117851448*^9, 3.848731215882345*^9}, {3.848731368069811*^9, 
   3.848731471807785*^9}, {3.84873199869241*^9, 3.848732002960984*^9}, {
   3.848732102803831*^9, 3.848732103884008*^9}, {3.84873215202113*^9, 
   3.848732172577151*^9}, {3.848732210170239*^9, 3.848732219332922*^9}, 
   3.848732310093638*^9, {3.848734709606974*^9, 3.848734717361208*^9}, {
   3.848735039972313*^9, 3.848735067245984*^9}, {3.848735374491328*^9, 
   3.84873541747466*^9}, {3.848735658106767*^9, 3.848735684353385*^9}, {
   3.848735757698831*^9, 3.848735810092058*^9}, {3.848735879831807*^9, 
   3.848735880029848*^9}, {3.848735945366605*^9, 3.848735971127491*^9}, {
   3.848738690586399*^9, 3.848738690802731*^9}, {3.848738815411833*^9, 
   3.848738815587101*^9}, {3.8487398632858057`*^9, 3.848739882493163*^9}, 
   3.848741311179636*^9, {3.848743004649357*^9, 3.848743011445449*^9}, {
   3.8509917325274696`*^9, 3.850991733089344*^9}, {3.851048091161504*^9, 
   3.851048093900271*^9}, {3.851048476809299*^9, 3.8510484832351203`*^9}, {
   3.851048554362056*^9, 3.851048554845625*^9}, {3.851048917453648*^9, 
   3.851048920534617*^9}, {3.8569430527000513`*^9, 3.85694305419662*^9}, {
   3.856943704430222*^9, 3.856943705032241*^9}, {3.856945030477242*^9, 
   3.856945044477646*^9}, {3.856945180207851*^9, 3.856945180362653*^9}, {
   3.856945301179715*^9, 3.856945311312457*^9}, {3.8569455064220743`*^9, 
   3.856945506636777*^9}, {3.856945700152598*^9, 3.856945747216476*^9}, {
   3.856946401259803*^9, 3.856946480235464*^9}, {3.856947338108768*^9, 
   3.856947468580448*^9}, {3.85694816427598*^9, 3.856948285837433*^9}, {
   3.856948585741437*^9, 3.856948610549939*^9}, {3.856948857232164*^9, 
   3.856948876332296*^9}, {3.856949258047681*^9, 3.856949270496598*^9}, {
   3.9363530509104223`*^9, 3.93635307862363*^9}, {3.936353133669702*^9, 
   3.936353145621428*^9}, {3.9406436244167223`*^9, 3.940643624714435*^9}, {
   3.940643689492838*^9, 3.9406436908771553`*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"3bf21af0-91c3-4515-b8b9-f47c47b551a5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"testProjector", "[", 
   RowBox[{
   "meta_", ",", "id_", ",", "infunc_", ",", "gfunc_", ",", "opfunc_", ",", 
    "name_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"outprec", " ", "=", " ", "32"}], ",", "a", ",", "b", ",", "i", 
      ",", "nN", ",", "gridN", ",", "ls", ",", "descr", ",", " ", "spec", ",",
       "phys", ",", "grid", ",", "inData", ",", "refData", ",", "msg", ",", 
      "tempmsg", ",", "fbase", ",", "fname"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"nN", "=", 
      RowBox[{"meta", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"gridN", " ", "=", " ", 
      RowBox[{"meta", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"meta", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"b", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"meta", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ls", "=", 
      RowBox[{
       RowBox[{"meta", "[", 
        RowBox[{"[", "3", "]"}], "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"spec", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"infunc", "[", 
         RowBox[{
          RowBox[{"i", "-", "1"}], ",", 
          RowBox[{"nN", "-", "1"}], ",", 
          RowBox[{"ls", "[", 
           RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "nN"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", 
          RowBox[{"Length", "@", "ls"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"inData", " ", "=", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"Re", "[", "spec", "]"}], ",", 
        RowBox[{"Im", "[", "spec", "]"}]}], "]"}]}], ";", 
     RowBox[{"msg", "=", 
      RowBox[{
      "\"\<Exporting \>\"", "<>", "name", "<>", 
       "\"\< Chebyshev operator for N = \>\"", "<>", 
       RowBox[{"ToString", "[", "nN", "]"}], "<>", "\"\<, Ng = \>\"", " ", "<>", 
       RowBox[{"ToString", "[", "gridN", "]"}], "<>", "\"\<, a = \>\"", "<>", 
       
       RowBox[{"ToString", "[", 
        RowBox[{"N", "[", 
         RowBox[{"a", ",", "5"}], "]"}], "]"}], "<>", "\"\<, b = \>\"", "<>", 
       
       RowBox[{"ToString", "[", 
        RowBox[{"N", "[", 
         RowBox[{"b", ",", "5"}], "]"}], "]"}], "<>", "\"\<, l = \>\"", "<>", 
       
       RowBox[{"ToString", "[", "ls", "]"}], "<>", "\"\<...\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"grid", " ", "=", " ", 
      RowBox[{"gfunc", "[", "gridN", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"phys", "=", 
      RowBox[{"ParallelTable", "[", 
       RowBox[{
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"i", ">", " ", "1"}], ",", " ", "2", ",", " ", "1"}], 
            "]"}], 
           RowBox[{"spec", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], 
           RowBox[{"opfunc", "[", 
            RowBox[{
             RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", 
             RowBox[{"ls", "[", 
              RowBox[{"[", "j", "]"}], "]"}], ",", "grid"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", 
          RowBox[{"Length", "@", "ls"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"refData", "=", 
      RowBox[{"N", "[", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"Re", "[", "phys", "]"}], "]"}], ",", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Im", "[", "phys", "]"}], "]"}]}], "]"}], ",", "outprec"}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fbase", "=", 
      RowBox[{"name", "<>", "\"\<_id\>\"", "<>", 
       RowBox[{"ToString", "[", "id", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fname", "=", 
      RowBox[{"fbase", "<>", "\"\<_meta.dat\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"descr", " ", "=", " ", 
      RowBox[{"Flatten", "[", "meta", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"descr", "[", 
       RowBox[{"[", "3", "]"}], "]"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"-", "a"}], " ", "+", " ", "b"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"descr", "[", 
       RowBox[{"[", "4", "]"}], "]"}], "=", 
      RowBox[{"a", "+", "b"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"descr", " ", "=", " ", 
      RowBox[{"Prepend", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{"descr", ",", "outprec"}], "]"}], ",", 
        RowBox[{"Length", "@", "descr"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"dataroot", ",", "refdir", ",", "fname"}], "}"}], "]"}], 
        "]"}], ",", "descr"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"fname", "=", 
      RowBox[{"fbase", "<>", "\"\<_in.dat\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"dataroot", ",", "refdir", ",", "fname"}], "}"}], "]"}], 
        "]"}], ",", "inData", ",", "\"\<Table\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fname", "=", 
      RowBox[{"fbase", "<>", "\"\<_ref.dat\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"dataroot", ",", "refdir", ",", "fname"}], "}"}], "]"}], 
        "]"}], ",", "refData", ",", "\"\<Table\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"Row", "[", 
       RowBox[{"{", 
        RowBox[{"msg", ",", 
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"\"\< Done(\>\"", "<>", 
            RowBox[{"DateString", "[", "]"}], "<>", "\"\<)\>\""}], ",", 
           RowBox[{"FontColor", "\[Rule]", "Green"}]}], "]"}]}], "}"}], "]"}],
       "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.848630466467435*^9, 3.848630470555498*^9}, {
   3.848630564293414*^9, 3.848630598029735*^9}, {3.848630717714239*^9, 
   3.848630814917403*^9}, {3.848631461432979*^9, 3.848631472849694*^9}, {
   3.84863158777179*^9, 3.848631630916475*^9}, {3.848631728913494*^9, 
   3.848631744804188*^9}, {3.84863261949995*^9, 3.8486326450782633`*^9}, {
   3.848632699325424*^9, 3.848632710625087*^9}, {3.848633897807592*^9, 
   3.848633927072812*^9}, {3.848633966716701*^9, 3.8486339697157383`*^9}, {
   3.848638319000198*^9, 3.848638320558275*^9}, {3.848638589581354*^9, 
   3.848638660970099*^9}, {3.848638728532304*^9, 3.848638737731852*^9}, {
   3.848720541339288*^9, 3.848720603809132*^9}, {3.848720643457205*^9, 
   3.848720673875478*^9}, {3.848720883430412*^9, 3.848720889370243*^9}, {
   3.848735077812364*^9, 3.848735088746603*^9}, {3.848735670419637*^9, 
   3.848735674365164*^9}, {3.848736429605699*^9, 3.848736459738048*^9}, 
   3.850991764627661*^9, {3.850991840970014*^9, 3.850991851106715*^9}},
 CellLabel->"In[30]:=",ExpressionUUID->"39d33efb-4852-4237-9edf-8769cd493b08"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"generateProjectors", "[", 
    RowBox[{"meta_", ",", "tId_", ",", "inOp_", ",", "gfunc_"}], "]"}], ":=", 
   
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"subdir", ",", "func"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"subdir", " ", "=", "\"\<Projector/\>\""}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", " ", "=", " ", "testProjector"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inOp", ",", "gfunc", ",", "Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<P\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inOp", ",", "gfunc", ",", "dTnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<D1\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inOp", ",", "gfunc", ",", "dyTnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<D1Y1\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inOp", ",", "gfunc", ",", "divydyTnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<DivY1D1Y1\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inOp", ",", "gfunc", ",", "d2Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<D2\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inOp", ",", "gfunc", ",", "d3Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<D3\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inOp", ",", "gfunc", ",", "d4Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<D4\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inOp", ",", "gfunc", ",", "divyTnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<DivY1\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inOp", ",", "gfunc", ",", "divy2Tnabl", ",", 
        
        RowBox[{"subdir", "<>", "\"\<DivY2\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inOp", ",", "gfunc", ",", "slaplTnabl", ",", 
        
        RowBox[{"subdir", "<>", "\"\<SphRadLapl\>\""}]}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.848630064626896*^9, 3.848630111571867*^9}, {
   3.8486304501640797`*^9, 3.848630450687812*^9}, 3.848630833661748*^9, {
   3.848721255398978*^9, 3.848721278831489*^9}, {3.848724425104047*^9, 
   3.8487244497016897`*^9}, {3.848725166498116*^9, 3.8487251767094197`*^9}, {
   3.848725760799109*^9, 3.848725787205972*^9}, {3.848726818262965*^9, 
   3.848726824446135*^9}, {3.848726968992082*^9, 3.848726996487983*^9}, {
   3.848741855817755*^9, 3.8487418585486736`*^9}, {3.848744345351952*^9, 
   3.848744349470261*^9}},
 CellLabel->"In[31]:=",ExpressionUUID->"5af23305-aef2-41e2-8726-851ccf5d1bc8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ab", " ", "=", " ", 
   RowBox[{"abSphere", "[", 
    FractionBox["7", "20"], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.848631155813589*^9, 3.848631158288791*^9}, {
  3.848631655605214*^9, 3.8486316643646917`*^9}, {3.848721511884447*^9, 
  3.848721512851106*^9}, {3.848730749046012*^9, 3.848730775754123*^9}, {
  3.848739920780733*^9, 3.848739943498784*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"de216113-265d-4668-a0f7-2560f47736a8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"generateProjectors", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"10", ",", "20", ",", 
      RowBox[{"{", 
       RowBox[{"ab", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "0",
     ",", "minSpectrum", ",", "chebgrid"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.848042079566894*^9, 3.848042115271824*^9}, {
  3.848630163252915*^9, 3.848630184842233*^9}, {3.84863043473332*^9, 
  3.848630435721219*^9}, {3.848630513610408*^9, 3.848630526096408*^9}, {
  3.84863060432757*^9, 3.848630625554902*^9}, {3.848631396540618*^9, 
  3.8486314142052393`*^9}, {3.848739960510014*^9, 3.8487399623250318`*^9}, {
  3.848740251352149*^9, 3.848740252491442*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"bf1cc371-48f4-48d4-b8f3-a1f7dd987e26"],

Cell[BoxData[
 RowBox[{
  RowBox[{"generateProjectors", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"10", ",", "20", ",", 
      RowBox[{"{", 
       RowBox[{"ab", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "1",
     ",", "maxSpectrum", ",", "chebgrid"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.8480327959268436`*^9, 3.848032808156605*^9}, {
   3.848033040620837*^9, 3.848033041485807*^9}, {3.848033264123011*^9, 
   3.848033285315278*^9}, {3.848036250750192*^9, 3.8480363159171968`*^9}, {
   3.848036549255954*^9, 3.8480365781665716`*^9}, 3.84804033070253*^9, {
   3.848040368472892*^9, 3.84804044772304*^9}, {3.848040506927525*^9, 
   3.848040512810543*^9}, {3.84804055168972*^9, 3.848040554670643*^9}, {
   3.848040673042045*^9, 3.848040683873992*^9}, {3.848041226876877*^9, 
   3.848041263902541*^9}, {3.848041302246331*^9, 3.848041373003251*^9}, {
   3.848041501674383*^9, 3.848041579415253*^9}, {3.848041629174865*^9, 
   3.848041737938336*^9}, {3.848042121681321*^9, 3.848042139727309*^9}, {
   3.8486304372519484`*^9, 3.8486304388429613`*^9}, {3.848630539612248*^9, 
   3.8486305446679096`*^9}, {3.848630609381185*^9, 3.8486306216469736`*^9}, {
   3.848631399724424*^9, 3.848631399948221*^9}, {3.8486316840492883`*^9, 
   3.848631684730764*^9}},
 CellLabel->"In[34]:=",ExpressionUUID->"a50dbb99-5c52-40f2-b506-085158fef463"],

Cell[BoxData[
 RowBox[{
  RowBox[{"generateProjectors", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"10", ",", "20", ",", 
      RowBox[{"{", 
       RowBox[{"ab", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "2",
     ",", "unitSpectrum", ",", "chebgrid"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.8480327959268436`*^9, 3.848032808156605*^9}, {
   3.848033040620837*^9, 3.848033041485807*^9}, {3.848033264123011*^9, 
   3.848033285315278*^9}, {3.848036250750192*^9, 3.8480363159171968`*^9}, {
   3.848036549255954*^9, 3.8480365781665716`*^9}, 3.84804033070253*^9, {
   3.848040368472892*^9, 3.84804044772304*^9}, {3.848040506927525*^9, 
   3.848040512810543*^9}, {3.84804055168972*^9, 3.848040554670643*^9}, {
   3.848040673042045*^9, 3.848040683873992*^9}, {3.848041226876877*^9, 
   3.848041263902541*^9}, {3.848041302246331*^9, 3.848041373003251*^9}, {
   3.848041501674383*^9, 3.848041579415253*^9}, {3.848041629174865*^9, 
   3.848041737938336*^9}, {3.848041779759917*^9, 3.84804178247956*^9}, {
   3.848042143290714*^9, 3.848042154091345*^9}, {3.848630440697487*^9, 
   3.84863044174303*^9}, {3.848630547770124*^9, 3.848630553367612*^9}, {
   3.848630614174631*^9, 3.848630616835202*^9}, {3.848631403006382*^9, 
   3.848631403389942*^9}, {3.848631687111252*^9, 3.848631687672746*^9}},
 CellLabel->"In[35]:=",ExpressionUUID->"498e4b6a-9b70-461f-b217-2bf3a80b441a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"testIntegrator", "[", 
    RowBox[{
    "meta_", ",", "id_", ",", "infunc_", ",", "outfunc_", ",", "gfunc_", ",", 
     "wfunc_", ",", "inopfunc_", ",", "opfunc_", ",", "name_"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"outprec", " ", "=", " ", "32"}], ",", "a", ",", "b", ",", "i",
        ",", "nN", ",", "gridN", ",", "ls", ",", "descr", ",", " ", "spec", 
       ",", "phys", ",", "grid", ",", "wgts", ",", "inData", ",", "refR", ",",
        " ", "refI", ",", "refData", ",", "msg", ",", "tempmsg", ",", "fbase",
        ",", "fname"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nN", "=", 
       RowBox[{"meta", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gridN", " ", "=", " ", 
       RowBox[{"meta", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"grid", " ", "=", " ", 
       RowBox[{"gfunc", "[", "gridN", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"a", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"meta", "[", 
          RowBox[{"[", "3", "]"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"meta", "[", 
          RowBox[{"[", "3", "]"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ls", "=", 
       RowBox[{
        RowBox[{"meta", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"phys", "=", 
       RowBox[{"ParallelTable", "[", 
        RowBox[{
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"infunc", "[", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", 
              RowBox[{"nN", "-", "1"}], ",", 
              RowBox[{"ls", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], "]"}], 
            RowBox[{"inopfunc", "[", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", 
              RowBox[{"ls", "[", 
               RowBox[{"[", "j", "]"}], "]"}], ",", "grid"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", 
           RowBox[{"Length", "@", "ls"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"inData", "=", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Transpose", "[", 
            RowBox[{"Re", "[", "phys", "]"}], "]"}], ",", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Im", "[", "phys", "]"}], "]"}]}], "]"}], ",", 
         "outprec"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"wgts", "=", 
       RowBox[{"wfunc", "[", "gridN", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"spec", "=", 
       RowBox[{"ParallelTable", "[", 
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{
           RowBox[{"wgts", " ", 
            RowBox[{"opfunc", "[", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", 
              RowBox[{"ls", "[", 
               RowBox[{"[", "j", "]"}], "]"}], ",", "grid"}], "]"}]}], ",", 
           RowBox[{"Transpose", "[", 
            RowBox[{"phys", "[", 
             RowBox[{"[", 
              RowBox[{"j", ",", ";;"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nN"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", 
           RowBox[{"Length", "@", "ls"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"refR", " ", "=", " ", 
       RowBox[{"Transpose", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"outfunc", "[", 
           RowBox[{
            RowBox[{"Re", "[", 
             RowBox[{"spec", "[", 
              RowBox[{"[", 
               RowBox[{";;", ",", "j"}], "]"}], "]"}], "]"}], ",", "a", ",", 
            "b", ",", " ", 
            RowBox[{"ls", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", 
            RowBox[{"Length", "@", "ls"}]}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"refI", " ", "=", " ", 
       RowBox[{"Transpose", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"outfunc", "[", 
           RowBox[{
            RowBox[{"Im", "[", 
             RowBox[{"spec", "[", 
              RowBox[{"[", 
               RowBox[{";;", ",", "j"}], "]"}], "]"}], "]"}], ",", "a", ",", 
            "b", ",", " ", 
            RowBox[{"ls", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", 
            RowBox[{"Length", "@", "ls"}]}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"refData", " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"refR", ",", "refI"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"msg", "=", 
       RowBox[{
       "\"\<Exporting \>\"", "<>", "name", "<>", 
        "\"\< Chebyshev operator for N = \>\"", "<>", 
        RowBox[{"ToString", "[", "nN", "]"}], "<>", "\"\<, Ng = \>\"", " ", "<>", 
        RowBox[{"ToString", "[", "gridN", "]"}], "<>", "\"\<, l = \>\"", "<>", 
        RowBox[{"ToString", "[", "ls", "]"}], "<>", "\"\<...\>\""}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fbase", "=", 
       RowBox[{"name", "<>", "\"\<_id\>\"", "<>", 
        RowBox[{"ToString", "[", "id", "]"}]}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"fname", "=", 
       RowBox[{"fbase", "<>", "\"\<_meta.dat\>\""}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"descr", " ", "=", " ", 
       RowBox[{"Flatten", "[", "meta", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"descr", "[", 
        RowBox[{"[", "3", "]"}], "]"}], " ", "=", " ", 
       RowBox[{
        RowBox[{"-", "a"}], " ", "+", " ", "b"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"descr", "[", 
        RowBox[{"[", "4", "]"}], "]"}], "=", 
       RowBox[{"a", "+", "b"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"descr", " ", "=", " ", 
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"descr", ",", "outprec"}], "]"}], ",", 
         RowBox[{"Length", "@", "descr"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{"dataroot", ",", "refdir", ",", "fname"}], "}"}], "]"}], 
         "]"}], ",", "descr"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"fname", "=", 
       RowBox[{"fbase", "<>", "\"\<_in.dat\>\""}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{"dataroot", ",", "refdir", ",", "fname"}], "}"}], "]"}], 
         "]"}], ",", "inData", ",", "\"\<Table\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fname", "=", 
       RowBox[{"fbase", "<>", "\"\<_ref.dat\>\""}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{"dataroot", ",", "refdir", ",", "fname"}], "}"}], "]"}], 
         "]"}], ",", "refData", ",", "\"\<Table\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"Row", "[", 
        RowBox[{"{", 
         RowBox[{"msg", ",", 
          RowBox[{"Style", "[", 
           RowBox[{
            RowBox[{"\"\< Done(\>\"", "<>", 
             RowBox[{"DateString", "[", "]"}], "<>", "\"\<)\>\""}], ",", 
            RowBox[{"FontColor", "\[Rule]", "Green"}]}], "]"}]}], "}"}], 
        "]"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.8486359146440067`*^9, 3.848635955690222*^9}, {
  3.848636072658938*^9, 3.848636090923204*^9}, {3.848637187838997*^9, 
  3.848637192264442*^9}, {3.848637244939484*^9, 3.84863727757812*^9}, {
  3.848637360345166*^9, 3.848637367856756*^9}, {3.8486374531447153`*^9, 
  3.848637475699669*^9}, {3.84863752544796*^9, 3.848637537090599*^9}, {
  3.8486380452195473`*^9, 3.848638048433873*^9}, {3.848638326822876*^9, 
  3.848638331437011*^9}, {3.848720495383918*^9, 3.84872050992815*^9}, {
  3.848720723273117*^9, 3.848720791399406*^9}, {3.848720913385691*^9, 
  3.848720919369065*^9}, {3.850992211158152*^9, 3.850992222504518*^9}, {
  3.856943100979178*^9, 3.856943103356378*^9}, {3.856943434176465*^9, 
  3.856943486120958*^9}, {3.856945148152416*^9, 3.856945152857778*^9}, {
  3.85694542518014*^9, 3.856945436491829*^9}},
 CellLabel->"In[73]:=",ExpressionUUID->"600c2424-f368-468d-812a-b7e683b155a7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"generateIntegrators", "[", 
    RowBox[{
    "meta_", ",", "tId_", ",", "inSpec_", ",", "gfunc_", ",", "wfunc_"}], 
    "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"subdir", ",", " ", "func"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"subdir", " ", "=", " ", "\"\<Integrator/\>\""}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "=", "testIntegrator"}], ";", "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inSpec", ",", "i0", ",", "gfunc", ",", 
        "wfunc", ",", "Tnabl", ",", "Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<P\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inSpec", ",", "i0", ",", "gfunc", ",", 
        "wfunc", ",", "divyTnabl", ",", "yTnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<Y1\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inSpec", ",", "i2", ",", "gfunc", ",", 
        "wfunc", ",", "Tnabl", ",", "Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<I2\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inSpec", ",", "i2y1", ",", "gfunc", ",", 
        "wfunc", ",", "Tnabl", ",", "Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<I2Y1_Zero\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inSpec", ",", "i2y2", ",", "gfunc", ",", 
        "wfunc", ",", "Tnabl", ",", "Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<I2Y2_Zero\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inSpec", ",", "i2Zi2d1", ",", "gfunc", ",", 
        "wfunc", ",", "Tnabl", ",", "Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<I2_I2D1\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inSpec", ",", "i2d1", ",", "gfunc", ",", 
        "wfunc", ",", "Tnabl", ",", "Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<I2D1\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inSpec", ",", "i2d1Zi2", ",", "gfunc", ",", 
        "wfunc", ",", "Tnabl", ",", "Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<I2D1_I2\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inSpec", ",", "i2y1d1y1", ",", "gfunc", ",", 
        "wfunc", ",", "Tnabl", ",", "Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<I2Y1D1Y1_Zero\>\""}]}], "]"}], ";", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inSpec", ",", "i2y2d1y1", ",", "gfunc", ",", 
        "wfunc", ",", "Tnabl", ",", "Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<I2Y2D1Y1_Zero\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inSpec", ",", "i4", ",", "gfunc", ",", 
        "wfunc", ",", "Tnabl", ",", "Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<I4\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inSpec", ",", "i4y3", ",", "gfunc", ",", 
        "wfunc", ",", "Tnabl", ",", "Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<I4Y3_Zero\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inSpec", ",", "i4d1", ",", "gfunc", ",", 
        "wfunc", ",", "Tnabl", ",", "Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<I4D1\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inSpec", ",", "i4d1Zi2", ",", "gfunc", ",", 
        "wfunc", ",", "Tnabl", ",", "Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<I4D1_I2\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inSpec", ",", "i4y3d1y1", ",", "gfunc", ",", 
        "wfunc", ",", "Tnabl", ",", "Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<I4Y3D1Y1_Zero\>\""}]}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAmIQ/WXaVs9Jq9847lhb4QOiSxa11IFokzT5ehA9YdLV
iyDaf/8bML3jZeNdEB3E3XcPRB/SU3gColk8W5+CaJ0vpVKTgfQf3mowbfXl
awSInrfMPQpET3ygXwmivwh/rQLRVUe1GsHqdJc3gWi/ws3dIDqqu7QHRC+Z
Ubplw5o3jg7C4btBNI9uzvcHQLqqw+IHiFZpZ/sLohcsjQbT6qKHox8C6Uud
OrEgWlBDOw1E63zzBdMu+Yw7nwLpH/e5wPRXgXlGnXveODIkc5iC6JY1srZd
QHqZwA8nEL0n7uJyEH1vV9gqEB1gZvcPRGsbWTB3A2kv0zZ2EL3t1hxeEL1r
f6gyiI7r01AF0b9OlneBaKXOFz0gepXm99r/wW8dSyyi60H0jym3A/Ri3joK
tfsEgugF987uANFR+ao7QTQA7U3lMw==
  "],ExpressionUUID->"6ccbbcfe-4cef-49f7-8da5-63b02e82980c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ab", " ", "=", " ", 
   RowBox[{"abSphere", "[", 
    FractionBox["7", "20"], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.848631155813589*^9, 3.848631158288791*^9}, {
  3.848631655605214*^9, 3.8486316643646917`*^9}},
 CellLabel->"In[75]:=",ExpressionUUID->"93dc5eeb-af6e-4677-9f21-7a7f827b3ed2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"generateIntegrators", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"10", ",", "20", ",", 
      RowBox[{"{", 
       RowBox[{"ab", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "0",
     ",", "minSpectrum", ",", "chebgrid", ",", "chebweights"}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.848042079566894*^9, 3.848042115271824*^9}, {
  3.8480492781839*^9, 3.848049279330017*^9}, {3.848050479696863*^9, 
  3.848050481060223*^9}, {3.848635870788719*^9, 3.848635898644442*^9}, {
  3.848636008035238*^9, 3.848636009440836*^9}},
 CellLabel->"In[76]:=",ExpressionUUID->"228cf6b0-abdf-4679-b6a9-f16828df2f45"],

Cell[BoxData[
 RowBox[{
  RowBox[{"generateIntegrators", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"10", ",", "20", ",", 
      RowBox[{"{", 
       RowBox[{"ab", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "1",
     ",", "maxSpectrum", ",", "chebgrid", ",", "chebweights"}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8480327959268436`*^9, 3.848032808156605*^9}, {
   3.848033040620837*^9, 3.848033041485807*^9}, {3.848033264123011*^9, 
   3.848033285315278*^9}, {3.848036250750192*^9, 3.848036315917197*^9}, {
   3.848036549255954*^9, 3.848036578166572*^9}, 3.84804033070253*^9, {
   3.848040368472892*^9, 3.84804044772304*^9}, {3.848040506927525*^9, 
   3.848040512810543*^9}, {3.84804055168972*^9, 3.848040554670643*^9}, {
   3.848040673042045*^9, 3.848040683873992*^9}, {3.848041226876877*^9, 
   3.848041263902541*^9}, {3.848041302246331*^9, 3.848041373003251*^9}, {
   3.848041501674383*^9, 3.848041579415253*^9}, {3.848041629174865*^9, 
   3.848041737938336*^9}, {3.848042121681321*^9, 3.848042139727309*^9}, {
   3.848049283097932*^9, 3.848049286160273*^9}, 3.848050486846911*^9, {
   3.8486358759841347`*^9, 3.8486359015240107`*^9}, {3.8486360132105017`*^9, 
   3.848636014334552*^9}},
 CellLabel->"In[77]:=",ExpressionUUID->"b8a00759-a107-487f-a54a-6322bdbd3748"],

Cell[BoxData[
 RowBox[{
  RowBox[{"generateIntegrators", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"10", ",", "20", ",", 
      RowBox[{"{", 
       RowBox[{"ab", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "2",
     ",", "unitSpectrum", ",", "chebgrid", ",", "chebweights"}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8480327959268436`*^9, 3.848032808156605*^9}, {
   3.848033040620837*^9, 3.848033041485807*^9}, {3.848033264123011*^9, 
   3.848033285315278*^9}, {3.848036250750192*^9, 3.848036315917197*^9}, {
   3.848036549255954*^9, 3.848036578166572*^9}, 3.84804033070253*^9, {
   3.848040368472892*^9, 3.84804044772304*^9}, {3.848040506927525*^9, 
   3.848040512810543*^9}, {3.84804055168972*^9, 3.848040554670643*^9}, {
   3.848040673042045*^9, 3.848040683873992*^9}, {3.848041226876877*^9, 
   3.848041263902541*^9}, {3.848041302246331*^9, 3.848041373003251*^9}, {
   3.848041501674383*^9, 3.848041579415253*^9}, {3.848041629174865*^9, 
   3.848041737938336*^9}, {3.848041779759917*^9, 3.84804178247956*^9}, {
   3.848042143290714*^9, 3.848042154091345*^9}, {3.848049289887857*^9, 
   3.848049292184197*^9}, 3.848050487967705*^9, {3.848635882650455*^9, 
   3.848635904363759*^9}, {3.848636018950247*^9, 3.848636020094496*^9}},
 CellLabel->"In[78]:=",ExpressionUUID->"89d632f7-08d6-4ffd-b73d-aabbeb002f0a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"testEnergy", "[", 
   RowBox[{
   "meta_", ",", "id_", ",", "infunc_", ",", "opfunc_", ",", "metric_", ",", 
    "name_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"outprec", " ", "=", " ", "32"}], ",", "a", ",", "b", ",", "i", 
      ",", "nN", ",", "gridN", ",", "ls", ",", "descr", ",", " ", "spec", ",",
       "phys", ",", "grid", ",", "inData", ",", "refData", ",", "msg", ",", 
      "tempmsg", ",", "fbase", ",", "fname"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"nN", "=", 
      RowBox[{"meta", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"gridN", " ", "=", " ", 
      RowBox[{"meta", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"meta", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"b", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"meta", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ls", "=", 
      RowBox[{
       RowBox[{"meta", "[", 
        RowBox[{"[", "3", "]"}], "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"spec", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"infunc", "[", 
         RowBox[{
          RowBox[{"i", "-", "1"}], ",", 
          RowBox[{"nN", "-", "1"}], ",", 
          RowBox[{"ls", "[", 
           RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "nN"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", 
          RowBox[{"Length", "@", "ls"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"inData", " ", "=", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"Re", "[", "spec", "]"}], ",", 
        RowBox[{"Im", "[", "spec", "]"}]}], "]"}]}], ";", 
     RowBox[{"msg", "=", 
      RowBox[{
      "\"\<Exporting \>\"", "<>", "name", "<>", 
       "\"\< Chebyshev operator for N = \>\"", "<>", 
       RowBox[{"ToString", "[", "nN", "]"}], "<>", "\"\<, Ng = \>\"", " ", "<>", 
       RowBox[{"ToString", "[", "gridN", "]"}], "<>", "\"\<, a = \>\"", "<>", 
       
       RowBox[{"ToString", "[", 
        RowBox[{"N", "[", 
         RowBox[{"a", ",", "5"}], "]"}], "]"}], "<>", "\"\<, b = \>\"", "<>", 
       
       RowBox[{"ToString", "[", 
        RowBox[{"N", "[", 
         RowBox[{"b", ",", "5"}], "]"}], "]"}], "<>", "\"\<, l = \>\"", "<>", 
       
       RowBox[{"ToString", "[", "ls", "]"}], "<>", "\"\<...\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"phys", "=", 
      RowBox[{"ParallelTable", "[", 
       RowBox[{
        RowBox[{"Integrate", "[", 
         RowBox[{
          RowBox[{"Simplify", "[", 
           RowBox[{"a", " ", 
            RowBox[{"metric", "[", 
             RowBox[{"a", ",", "b", ",", "x"}], "]"}], 
            RowBox[{"(", 
             RowBox[{
              SuperscriptBox[
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"i", ">", " ", "1"}], ",", " ", "2", ",", " ", 
                    "1"}], "]"}], 
                  RowBox[{"Re", "[", 
                   RowBox[{"spec", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], 
                  RowBox[{"opfunc", "[", 
                   RowBox[{
                    RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", 
                    RowBox[{"ls", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ",", "x"}], "]"}]}], ",", 
                 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}], "2"], 
              "+", 
              SuperscriptBox[
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"i", ">", " ", "1"}], ",", " ", "2", ",", " ", 
                    "1"}], "]"}], 
                  RowBox[{"Im", "[", 
                   RowBox[{"spec", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], 
                  RowBox[{"opfunc", "[", 
                   RowBox[{
                    RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", 
                    RowBox[{"ls", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ",", "x"}], "]"}]}], ",", 
                 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}], "2"]}], 
             ")"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"x", ",", 
            RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", 
          RowBox[{"Length", "@", "ls"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"refData", "=", 
      RowBox[{"N", "[", 
       RowBox[{"phys", ",", "outprec"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"fbase", "=", 
      RowBox[{"name", "<>", "\"\<_id\>\"", "<>", 
       RowBox[{"ToString", "[", "id", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fname", "=", 
      RowBox[{"fbase", "<>", "\"\<_meta.dat\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"descr", " ", "=", " ", 
      RowBox[{"Flatten", "[", "meta", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"descr", "[", 
       RowBox[{"[", "3", "]"}], "]"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"-", "a"}], " ", "+", " ", "b"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"descr", "[", 
       RowBox[{"[", "4", "]"}], "]"}], "=", 
      RowBox[{"a", "+", "b"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"descr", " ", "=", " ", 
      RowBox[{"Prepend", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{"descr", ",", "outprec"}], "]"}], ",", 
        RowBox[{"Length", "@", "descr"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"dataroot", ",", "refdir", ",", "fname"}], "}"}], "]"}], 
        "]"}], ",", "descr"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"fname", "=", 
      RowBox[{"fbase", "<>", "\"\<_in.dat\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"dataroot", ",", "refdir", ",", "fname"}], "}"}], "]"}], 
        "]"}], ",", "inData", ",", "\"\<Table\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fname", "=", 
      RowBox[{"fbase", "<>", "\"\<_ref.dat\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"dataroot", ",", "refdir", ",", "fname"}], "}"}], "]"}], 
        "]"}], ",", "refData", ",", "\"\<Table\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"Row", "[", 
       RowBox[{"{", 
        RowBox[{"msg", ",", 
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"\"\< Done(\>\"", "<>", 
            RowBox[{"DateString", "[", "]"}], "<>", "\"\<)\>\""}], ",", 
           RowBox[{"FontColor", "\[Rule]", "Green"}]}], "]"}]}], "}"}], "]"}],
       "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.848630466467435*^9, 3.848630470555498*^9}, {
   3.848630564293414*^9, 3.848630598029735*^9}, {3.848630717714239*^9, 
   3.8486308149174027`*^9}, {3.848631461432979*^9, 3.848631472849694*^9}, {
   3.84863158777179*^9, 3.848631630916475*^9}, {3.848631728913494*^9, 
   3.848631744804188*^9}, {3.84863261949995*^9, 3.8486326450782633`*^9}, {
   3.848632699325424*^9, 3.848632710625087*^9}, {3.848633897807592*^9, 
   3.848633927072812*^9}, {3.848633966716701*^9, 3.8486339697157383`*^9}, {
   3.848638319000198*^9, 3.848638320558275*^9}, {3.848638589581354*^9, 
   3.848638660970099*^9}, {3.848638728532304*^9, 3.848638737731852*^9}, {
   3.848720541339288*^9, 3.848720603809132*^9}, {3.848720643457205*^9, 
   3.848720673875478*^9}, {3.848720883430412*^9, 3.848720889370243*^9}, {
   3.848735077812364*^9, 3.848735088746603*^9}, {3.848735670419637*^9, 
   3.848735674365164*^9}, {3.848736429605699*^9, 3.848736459738048*^9}, 
   3.850991764627661*^9, {3.8509918409700136`*^9, 3.8509918511067147`*^9}, {
   3.85104489999824*^9, 3.851044996933858*^9}, {3.851045284006328*^9, 
   3.85104528451003*^9}, {3.851045375980709*^9, 3.851045377127684*^9}, {
   3.851045408839551*^9, 3.851045418467761*^9}, {3.851045727145719*^9, 
   3.851045741613258*^9}, {3.8510459557638187`*^9, 3.851045968131823*^9}, {
   3.851046122708169*^9, 3.851046144567971*^9}, {3.851046366406817*^9, 
   3.85104636837234*^9}, {3.8510465565914993`*^9, 3.851046585586802*^9}, {
   3.851046824604988*^9, 3.851046827067577*^9}, {3.8510468915524397`*^9, 
   3.851046893581496*^9}, {3.8510470615361967`*^9, 3.8510470629138737`*^9}, 
   3.851047885554392*^9, {3.851049051738455*^9, 3.851049075292199*^9}, {
   3.851049242494062*^9, 3.851049242672592*^9}},
 CellLabel->"In[53]:=",ExpressionUUID->"4dd0e3b7-cb80-4ea3-bc16-92657c4b252d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"generateEnergies", "[", 
    RowBox[{"meta_", ",", "tId_", ",", "inOp_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"subdir", ",", "func", ",", "sphMetric", ",", "cartMetric"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"subdir", " ", "=", "\"\<Reductor/\>\""}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", " ", "=", " ", "testEnergy"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"sphMetric", "[", 
        RowBox[{"a_", ",", "b_", ",", "x_"}], "]"}], ":=", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", " ", "x"}], " ", "+", " ", "b"}], ")"}], "2"]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cartMetric", "[", 
        RowBox[{"a_", ",", "b_", ",", "x_"}], "]"}], ":=", "1"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inOp", ",", "divyTnabl", ",", "sphMetric", 
        ",", 
        RowBox[{"subdir", "<>", "\"\<Energy\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inOp", ",", "Tnabl", ",", "sphMetric", ",", 
        RowBox[{"subdir", "<>", "\"\<EnergyY2\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inOp", ",", "dTnabl", ",", "cartMetric", ",", 
        RowBox[{"subdir", "<>", "\"\<EnergyD1\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inOp", ",", "divydyTnabl", ",", "sphMetric", 
        ",", 
        RowBox[{"subdir", "<>", "\"\<EnergyD1Y1\>\""}]}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.848630064626896*^9, 3.848630111571867*^9}, {
   3.8486304501640797`*^9, 3.848630450687812*^9}, 3.848630833661748*^9, {
   3.848721255398978*^9, 3.848721278831489*^9}, {3.848724425104047*^9, 
   3.8487244497016897`*^9}, {3.848725166498116*^9, 3.8487251767094197`*^9}, {
   3.848725760799109*^9, 3.848725787205972*^9}, {3.848726818262965*^9, 
   3.848726824446135*^9}, {3.848726968992082*^9, 3.848726996487983*^9}, {
   3.848741855817755*^9, 3.8487418585486736`*^9}, {3.848744345351952*^9, 
   3.848744349470261*^9}, {3.851045462364358*^9, 3.851045532494142*^9}, {
   3.851046241860544*^9, 3.851046266804843*^9}, {3.851049112440935*^9, 
   3.8510491857029653`*^9}},
 CellLabel->"In[54]:=",ExpressionUUID->"c040466a-b7e1-4ec8-8425-d0db881467a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ab", " ", "=", " ", 
   RowBox[{"abSphere", "[", 
    FractionBox["7", "20"], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.848631155813589*^9, 3.848631158288791*^9}, {
  3.848631655605214*^9, 3.8486316643646917`*^9}, {3.848721511884447*^9, 
  3.848721512851106*^9}, {3.848730749046012*^9, 3.848730775754123*^9}, {
  3.848739920780733*^9, 3.848739943498784*^9}},
 CellLabel->"In[55]:=",ExpressionUUID->"6cc9b99f-0fb9-4fb6-9235-955a9c42e39c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"generateEnergies", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"10", ",", "20", ",", 
      RowBox[{"{", 
       RowBox[{"ab", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "0",
     ",", "minSpectrum"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.848042079566894*^9, 3.848042115271824*^9}, {
  3.8480492781839*^9, 3.848049279330017*^9}, {3.848050479696863*^9, 
  3.848050481060223*^9}, {3.848635870788719*^9, 3.848635898644442*^9}, {
  3.848636008035238*^9, 3.848636009440836*^9}, {3.8510455623106947`*^9, 
  3.851045563375568*^9}, {3.851045620516434*^9, 3.851045621037554*^9}},
 CellLabel->"In[56]:=",ExpressionUUID->"08fe9b77-8a62-495f-8202-270f32321ea8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"generateEnergies", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"10", ",", "20", ",", 
      RowBox[{"{", 
       RowBox[{"ab", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "1",
     ",", "maxSpectrum"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.8480327959268436`*^9, 3.848032808156605*^9}, {
   3.848033040620837*^9, 3.848033041485807*^9}, {3.848033264123011*^9, 
   3.848033285315278*^9}, {3.848036250750192*^9, 3.8480363159171968`*^9}, {
   3.848036549255954*^9, 3.8480365781665716`*^9}, 3.84804033070253*^9, {
   3.848040368472892*^9, 3.84804044772304*^9}, {3.848040506927525*^9, 
   3.848040512810543*^9}, {3.84804055168972*^9, 3.848040554670643*^9}, {
   3.848040673042045*^9, 3.848040683873992*^9}, {3.848041226876877*^9, 
   3.848041263902541*^9}, {3.848041302246331*^9, 3.848041373003251*^9}, {
   3.848041501674383*^9, 3.848041579415253*^9}, {3.848041629174865*^9, 
   3.848041737938336*^9}, {3.848042121681321*^9, 3.848042139727309*^9}, {
   3.848049283097932*^9, 3.848049286160273*^9}, 3.848050486846911*^9, {
   3.8486358759841347`*^9, 3.8486359015240107`*^9}, {3.8486360132105017`*^9, 
   3.848636014334552*^9}, {3.85104556682262*^9, 3.85104557609017*^9}, 
   3.851045624140359*^9},
 CellLabel->"In[57]:=",ExpressionUUID->"8f43c2b0-cf80-4478-97d6-b4d48490b17f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"generateEnergies", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"10", ",", "20", ",", 
      RowBox[{"{", 
       RowBox[{"ab", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "2",
     ",", "unitSpectrum"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.8480327959268436`*^9, 3.848032808156605*^9}, {
   3.848033040620837*^9, 3.848033041485807*^9}, {3.848033264123011*^9, 
   3.848033285315278*^9}, {3.848036250750192*^9, 3.8480363159171968`*^9}, {
   3.848036549255954*^9, 3.8480365781665716`*^9}, 3.84804033070253*^9, {
   3.848040368472892*^9, 3.84804044772304*^9}, {3.848040506927525*^9, 
   3.848040512810543*^9}, {3.84804055168972*^9, 3.848040554670643*^9}, {
   3.848040673042045*^9, 3.848040683873992*^9}, {3.848041226876877*^9, 
   3.848041263902541*^9}, {3.848041302246331*^9, 3.848041373003251*^9}, {
   3.848041501674383*^9, 3.848041579415253*^9}, {3.848041629174865*^9, 
   3.848041737938336*^9}, {3.848041779759917*^9, 3.84804178247956*^9}, {
   3.848042143290714*^9, 3.848042154091345*^9}, {3.848049289887857*^9, 
   3.848049292184197*^9}, 3.848050487967705*^9, {3.848635882650455*^9, 
   3.848635904363759*^9}, {3.848636018950247*^9, 3.848636020094496*^9}, {
   3.851045571376449*^9, 3.85104557280619*^9}, 3.851045626800699*^9},
 CellLabel->"In[58]:=",ExpressionUUID->"423932f6-8536-41fb-bbcd-cc73d8d47b4c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"testBFLoop", "[", 
   RowBox[{
   "meta_", ",", "id_", ",", "infunc_", ",", "gfunc_", ",", "wfunc_", ",", 
    "bopfunc_", ",", "fopfunc_", ",", "name_"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"outprec", " ", "=", " ", "32"}], ",", "a", ",", "b", ",", "i", 
      ",", "nN", ",", "gridN", ",", "ls", ",", "descr", ",", " ", "spec", ",",
       "phys", ",", "grid", ",", "wgts", ",", "inData", ",", "refData", ",", 
      "msg", ",", "tempmsg", ",", "fbase", ",", "fname"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"nN", "=", 
      RowBox[{"meta", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"gridN", " ", "=", " ", 
      RowBox[{"meta", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"meta", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"b", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"meta", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ls", "=", 
      RowBox[{
       RowBox[{"meta", "[", 
        RowBox[{"[", "3", "]"}], "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"spec", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"infunc", "[", 
         RowBox[{
          RowBox[{"i", "-", "1"}], ",", 
          RowBox[{"nN", "-", "1"}], ",", 
          RowBox[{"ls", "[", 
           RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "nN"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", 
          RowBox[{"Length", "@", "ls"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"inData", " ", "=", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"Re", "[", "spec", "]"}], ",", 
        RowBox[{"Im", "[", "spec", "]"}]}], "]"}]}], ";", 
     RowBox[{"msg", "=", 
      RowBox[{
      "\"\<Exporting \>\"", "<>", "name", "<>", 
       "\"\< Chebyshev operator for N = \>\"", "<>", 
       RowBox[{"ToString", "[", "nN", "]"}], "<>", "\"\<, Ng = \>\"", " ", "<>", 
       RowBox[{"ToString", "[", "gridN", "]"}], "<>", "\"\<, a = \>\"", "<>", 
       
       RowBox[{"ToString", "[", 
        RowBox[{"N", "[", 
         RowBox[{"a", ",", "5"}], "]"}], "]"}], "<>", "\"\<, b = \>\"", "<>", 
       
       RowBox[{"ToString", "[", 
        RowBox[{"N", "[", 
         RowBox[{"b", ",", "5"}], "]"}], "]"}], "<>", "\"\<, l = \>\"", "<>", 
       
       RowBox[{"ToString", "[", "ls", "]"}], "<>", "\"\<...\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"grid", " ", "=", " ", 
      RowBox[{"gfunc", "[", "gridN", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"phys", "=", 
      RowBox[{"ParallelTable", "[", 
       RowBox[{
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"i", ">", " ", "1"}], ",", " ", "2", ",", " ", "1"}], 
            "]"}], 
           RowBox[{"spec", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], 
           RowBox[{"bopfunc", "[", 
            RowBox[{
             RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", 
             RowBox[{"ls", "[", 
              RowBox[{"[", "j", "]"}], "]"}], ",", "grid"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nN"}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", 
          RowBox[{"Length", "@", "ls"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"wgts", "=", 
      RowBox[{"wfunc", "[", "gridN", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"spec", "=", 
      RowBox[{"ParallelTable", "[", 
       RowBox[{
        RowBox[{"Dot", "[", 
         RowBox[{
          RowBox[{"wgts", " ", 
           RowBox[{"fopfunc", "[", 
            RowBox[{
             RowBox[{"i", "-", "1"}], ",", "a", ",", "b", ",", 
             RowBox[{"ls", "[", 
              RowBox[{"[", "j", "]"}], "]"}], ",", "grid"}], "]"}]}], ",", 
          RowBox[{"Transpose", "[", 
           RowBox[{"phys", "[", 
            RowBox[{"[", 
             RowBox[{"j", ",", ";;"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "nN"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", 
          RowBox[{"Length", "@", "ls"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"refData", " ", "=", " ", 
      RowBox[{"Chop", "[", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"Re", "[", "spec", "]"}], ",", 
          RowBox[{"Im", "[", "spec", "]"}]}], "]"}], ",", 
        SuperscriptBox["10", 
         RowBox[{
          RowBox[{"-", "mpprec"}], "+", "5"}]]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fbase", "=", 
      RowBox[{"name", "<>", "\"\<_id\>\"", "<>", 
       RowBox[{"ToString", "[", "id", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fname", "=", 
      RowBox[{"fbase", "<>", "\"\<_meta.dat\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"descr", " ", "=", " ", 
      RowBox[{"Flatten", "[", "meta", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"descr", "[", 
       RowBox[{"[", "3", "]"}], "]"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"-", "a"}], " ", "+", " ", "b"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"descr", "[", 
       RowBox[{"[", "4", "]"}], "]"}], "=", 
      RowBox[{"a", "+", "b"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"descr", " ", "=", " ", 
      RowBox[{"Prepend", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{"descr", ",", "outprec"}], "]"}], ",", 
        RowBox[{"Length", "@", "descr"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"dataroot", ",", "refdir", ",", "fname"}], "}"}], "]"}], 
        "]"}], ",", "descr"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"fname", "=", 
      RowBox[{"fbase", "<>", "\"\<_in.dat\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"dataroot", ",", "refdir", ",", "fname"}], "}"}], "]"}], 
        "]"}], ",", "inData", ",", "\"\<Table\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fname", "=", 
      RowBox[{"fbase", "<>", "\"\<_ref.dat\>\""}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"dataroot", ",", "refdir", ",", "fname"}], "}"}], "]"}], 
        "]"}], ",", "refData", ",", "\"\<Table\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"Row", "[", 
       RowBox[{"{", 
        RowBox[{"msg", ",", 
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"\"\< Done(\>\"", "<>", 
            RowBox[{"DateString", "[", "]"}], "<>", "\"\<)\>\""}], ",", 
           RowBox[{"FontColor", "\[Rule]", "Green"}]}], "]"}]}], "}"}], "]"}],
       "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.848630466467435*^9, 3.848630470555498*^9}, {
   3.848630564293414*^9, 3.848630598029735*^9}, {3.848630717714239*^9, 
   3.8486308149174027`*^9}, {3.848631461432979*^9, 3.848631472849694*^9}, {
   3.84863158777179*^9, 3.848631630916475*^9}, {3.848631728913494*^9, 
   3.848631744804188*^9}, {3.84863261949995*^9, 3.8486326450782633`*^9}, {
   3.848632699325424*^9, 3.848632710625087*^9}, {3.848633897807592*^9, 
   3.848633927072812*^9}, {3.848633966716701*^9, 3.8486339697157383`*^9}, {
   3.848638319000198*^9, 3.848638320558275*^9}, {3.848638589581354*^9, 
   3.848638660970099*^9}, {3.848638728532304*^9, 3.848638737731852*^9}, {
   3.848720541339288*^9, 3.848720603809132*^9}, {3.848720643457205*^9, 
   3.848720673875478*^9}, {3.848720883430412*^9, 3.848720889370243*^9}, {
   3.848735077812364*^9, 3.848735088746603*^9}, {3.848735670419637*^9, 
   3.848735674365164*^9}, {3.848736429605699*^9, 3.848736459738048*^9}, 
   3.850991764627661*^9, {3.8509918409700136`*^9, 3.8509918511067147`*^9}, {
   3.851049590805752*^9, 3.851049591690484*^9}, {3.851049643816676*^9, 
   3.851049720958718*^9}, {3.8510497615307627`*^9, 3.851049815697487*^9}},
 CellLabel->"In[59]:=",ExpressionUUID->"41ef0553-39fa-4dd1-85b0-34695d4e51e9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"generateBFLoops", "[", 
    RowBox[{
    "meta_", ",", "tId_", ",", "inSpec_", ",", "gfunc_", ",", "wfunc_"}], 
    "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"subdir", ",", "func"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"subdir", " ", "=", "\"\<BFLoop/\>\""}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", " ", "=", " ", "testBFLoop"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"func", "[", 
       RowBox[{
       "meta", ",", "tId", ",", "inSpec", ",", "gfunc", ",", "wfunc", ",", 
        "Tnabl", ",", "Tnabl", ",", 
        RowBox[{"subdir", "<>", "\"\<P\>\""}]}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.848630064626896*^9, 3.848630111571867*^9}, {
   3.8486304501640797`*^9, 3.848630450687812*^9}, 3.848630833661748*^9, {
   3.848721255398978*^9, 3.848721278831489*^9}, {3.848724425104047*^9, 
   3.8487244497016897`*^9}, {3.848725166498116*^9, 3.8487251767094197`*^9}, {
   3.848725760799109*^9, 3.848725787205972*^9}, {3.848726818262965*^9, 
   3.848726824446135*^9}, {3.848726968992082*^9, 3.848726996487983*^9}, {
   3.848741855817755*^9, 3.8487418585486736`*^9}, {3.848744345351952*^9, 
   3.848744349470261*^9}, {3.851049877291661*^9, 3.851049926294733*^9}},
 CellLabel->"In[65]:=",ExpressionUUID->"22b6bd3d-57ea-4d2d-b9c0-67c1a5cda241"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ab", " ", "=", " ", 
   RowBox[{"abSphere", "[", 
    FractionBox["7", "20"], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.848631155813589*^9, 3.848631158288791*^9}, {
  3.848631655605214*^9, 3.8486316643646917`*^9}, {3.848721511884447*^9, 
  3.848721512851106*^9}, {3.848730749046012*^9, 3.848730775754123*^9}, {
  3.848739920780733*^9, 3.848739943498784*^9}},
 CellLabel->"In[89]:=",ExpressionUUID->"35b24e1a-6bf6-4567-a9b3-dabe840aad1c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"generateBFLoops", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"10", ",", "20", ",", 
      RowBox[{"{", 
       RowBox[{"ab", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "0",
     ",", "minSpectrum", ",", "chebgrid", ",", "chebweights"}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.848042079566894*^9, 3.848042115271824*^9}, {
  3.848630163252915*^9, 3.848630184842233*^9}, {3.84863043473332*^9, 
  3.848630435721219*^9}, {3.848630513610408*^9, 3.848630526096408*^9}, {
  3.84863060432757*^9, 3.848630625554902*^9}, {3.848631396540618*^9, 
  3.8486314142052393`*^9}, {3.848739960510014*^9, 3.8487399623250318`*^9}, {
  3.848740251352149*^9, 3.848740252491442*^9}, {3.8510499325623827`*^9, 
  3.851049933487736*^9}, {3.851049963856357*^9, 3.851049966154806*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"50912dd9-cbfa-4b4b-aada-2f5e02cb438f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"generateBFLoops", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"10", ",", "20", ",", 
      RowBox[{"{", 
       RowBox[{"ab", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "1",
     ",", "maxSpectrum", ",", "chebgrid", ",", "chebweights"}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8480327959268436`*^9, 3.848032808156605*^9}, {
   3.848033040620837*^9, 3.848033041485807*^9}, {3.848033264123011*^9, 
   3.848033285315278*^9}, {3.848036250750192*^9, 3.8480363159171968`*^9}, {
   3.848036549255954*^9, 3.8480365781665716`*^9}, 3.84804033070253*^9, {
   3.848040368472892*^9, 3.84804044772304*^9}, {3.848040506927525*^9, 
   3.848040512810543*^9}, {3.84804055168972*^9, 3.848040554670643*^9}, {
   3.848040673042045*^9, 3.848040683873992*^9}, {3.848041226876877*^9, 
   3.848041263902541*^9}, {3.848041302246331*^9, 3.848041373003251*^9}, {
   3.848041501674383*^9, 3.848041579415253*^9}, {3.848041629174865*^9, 
   3.848041737938336*^9}, {3.848042121681321*^9, 3.848042139727309*^9}, {
   3.8486304372519484`*^9, 3.8486304388429613`*^9}, {3.848630539612248*^9, 
   3.8486305446679096`*^9}, {3.848630609381185*^9, 3.8486306216469736`*^9}, {
   3.848631399724424*^9, 3.848631399948221*^9}, {3.8486316840492883`*^9, 
   3.848631684730764*^9}, {3.851049941750182*^9, 3.851049971354949*^9}},
 CellLabel->"In[67]:=",ExpressionUUID->"3194010d-46d8-4268-9ab7-96cf61a8ccd1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"generateBFLoops", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"10", ",", "20", ",", 
      RowBox[{"{", 
       RowBox[{"ab", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}]}], "}"}], ",", "2",
     ",", "unitSpectrum", ",", "chebgrid", ",", "chebweights"}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8480327959268436`*^9, 3.848032808156605*^9}, {
   3.848033040620837*^9, 3.848033041485807*^9}, {3.848033264123011*^9, 
   3.848033285315278*^9}, {3.848036250750192*^9, 3.8480363159171968`*^9}, {
   3.848036549255954*^9, 3.8480365781665716`*^9}, 3.84804033070253*^9, {
   3.848040368472892*^9, 3.84804044772304*^9}, {3.848040506927525*^9, 
   3.848040512810543*^9}, {3.84804055168972*^9, 3.848040554670643*^9}, {
   3.848040673042045*^9, 3.848040683873992*^9}, {3.848041226876877*^9, 
   3.848041263902541*^9}, {3.848041302246331*^9, 3.848041373003251*^9}, {
   3.848041501674383*^9, 3.848041579415253*^9}, {3.848041629174865*^9, 
   3.848041737938336*^9}, {3.848041779759917*^9, 3.84804178247956*^9}, {
   3.848042143290714*^9, 3.848042154091345*^9}, {3.848630440697487*^9, 
   3.84863044174303*^9}, {3.848630547770124*^9, 3.848630553367612*^9}, {
   3.848630614174631*^9, 3.848630616835202*^9}, {3.848631403006382*^9, 
   3.848631403389942*^9}, {3.848631687111252*^9, 3.848631687672746*^9}, {
   3.851049945962193*^9, 3.8510499747378383`*^9}},
 CellLabel->"In[68]:=",ExpressionUUID->"43b2dcc2-2d3e-4bc1-b5d7-e96c02d23320"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.856941586441871*^9, 3.8569416123703423`*^9}, {
   3.85694169376269*^9, 3.856941825559051*^9}, {3.856941868490189*^9, 
   3.8569419525598373`*^9}, {3.85694207514107*^9, 3.856942093993856*^9}, {
   3.856942446932796*^9, 3.856942472964941*^9}, {3.856942606364663*^9, 
   3.856942684700409*^9}, {3.8569427536916647`*^9, 3.856942766462369*^9}, {
   3.856942836156313*^9, 3.856942884052285*^9}, {3.856942942267648*^9, 
   3.856942944055951*^9}, {3.856942978024882*^9, 3.856942983866433*^9}, 
   3.8569430452812*^9},ExpressionUUID->"f36626d0-0941-4913-8d00-99b81ad0cf81"]
},
WindowSize->{1035, 796.5},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"14.0 for Linux x86 (64-bit) (December 12, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"014fe338-37ef-46d7-8e39-0daae2be1759"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 1932, 54, 252, "Input",ExpressionUUID->"d658a15c-d0fa-4364-885d-b052f24ca2ad",
 InitializationCell->True],
Cell[2493, 76, 47171, 1264, 3805, "Input",ExpressionUUID->"3bf21af0-91c3-4515-b8b9-f47c47b551a5",
 InitializationCell->True],
Cell[49667, 1342, 8002, 192, 590, "Input",ExpressionUUID->"39d33efb-4852-4237-9edf-8769cd493b08",
 InitializationCell->True],
Cell[57672, 1536, 3313, 75, 302, "Input",ExpressionUUID->"5af23305-aef2-41e2-8726-851ccf5d1bc8"],
Cell[60988, 1613, 478, 9, 44, "Input",ExpressionUUID->"de216113-265d-4668-a0f7-2560f47736a8"],
Cell[61469, 1624, 827, 17, 29, "Input",ExpressionUUID->"bf1cc371-48f4-48d4-b8f3-a1f7dd987e26"],
Cell[62299, 1643, 1403, 25, 29, "Input",ExpressionUUID->"a50dbb99-5c52-40f2-b506-085158fef463"],
Cell[63705, 1670, 1438, 25, 29, "Input",ExpressionUUID->"498e4b6a-9b70-461f-b217-2bf3a80b441a"],
Cell[65146, 1697, 9404, 225, 678, "Input",ExpressionUUID->"600c2424-f368-468d-812a-b7e683b155a7",
 InitializationCell->True],
Cell[74553, 1924, 5099, 113, 405, "Input",ExpressionUUID->"6ccbbcfe-4cef-49f7-8da5-63b02e82980c"],
Cell[79655, 2039, 334, 7, 44, "Input",ExpressionUUID->"93dc5eeb-af6e-4677-9f21-7a7f827b3ed2"],
Cell[79992, 2048, 703, 16, 29, "Input",ExpressionUUID->"228cf6b0-abdf-4679-b6a9-f16828df2f45"],
Cell[80698, 2066, 1345, 25, 29, "Input",ExpressionUUID->"b8a00759-a107-487f-a54a-6322bdbd3748"],
Cell[82046, 2093, 1385, 25, 29, "Input",ExpressionUUID->"89d632f7-08d6-4ffd-b73d-aabbeb002f0a"],
Cell[83434, 2120, 9852, 229, 642, "Input",ExpressionUUID->"4dd0e3b7-cb80-4ea3-bc16-92657c4b252d"],
Cell[93289, 2351, 2647, 59, 297, "Input",ExpressionUUID->"c040466a-b7e1-4ec8-8425-d0db881467a0"],
Cell[95939, 2412, 478, 9, 43, "Input",ExpressionUUID->"6cc9b99f-0fb9-4fb6-9235-955a9c42e39c"],
Cell[96420, 2423, 757, 16, 29, "Input",ExpressionUUID->"08fe9b77-8a62-495f-8202-270f32321ea8"],
Cell[97180, 2441, 1376, 25, 29, "Input",ExpressionUUID->"8f43c2b0-cf80-4478-97d6-b4d48490b17f"],
Cell[98559, 2468, 1417, 25, 29, "Input",ExpressionUUID->"423932f6-8536-41fb-bbcd-cc73d8d47b4c"],
Cell[99979, 2495, 9081, 218, 888, "Input",ExpressionUUID->"41ef0553-39fa-4dd1-85b0-34695d4e51e9"],
Cell[109063, 2715, 1443, 30, 152, "Input",ExpressionUUID->"22b6bd3d-57ea-4d2d-b9c0-67c1a5cda241"],
Cell[110509, 2747, 478, 9, 43, "Input",ExpressionUUID->"35b24e1a-6bf6-4567-a9b3-dabe840aad1c"],
Cell[110990, 2758, 944, 19, 50, "Input",ExpressionUUID->"50912dd9-cbfa-4b4b-aada-2f5e02cb438f"],
Cell[111937, 2779, 1469, 26, 50, "Input",ExpressionUUID->"3194010d-46d8-4268-9ab7-96cf61a8ccd1"],
Cell[113409, 2807, 1510, 27, 50, "Input",ExpressionUUID->"43b2dcc2-2d3e-4bc1-b5d7-e96c02d23320"],
Cell[114922, 2836, 613, 8, 29, "Input",ExpressionUUID->"f36626d0-0941-4913-8d00-99b81ad0cf81"]
}
]
*)

